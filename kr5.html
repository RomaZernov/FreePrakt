
<!DOCTYPE html>  
<html lang="ru">  
  <head>  
    <meta charset="UTF-8" />  
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />  
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />  
    <link rel="stylesheet" href="style.css" />  
  <link rel="stylesheet" href="api.php.json">
    <title>KR</title>  
  </head>  
  <body>  
    <section>  
      <h1>  
       Саня и Ромчик представляют 
      </h1>  
    </section>  
    <section>  
      <label for="year">Введите год :</label>    
      <input type="text" name="year" value="" id="year" />    
      <br />    
        
      <label for="month">Выберите месяц:</label>    
    
      <select type="text" name="month" id="month">  
         
        <option value="01">Январь</option>  
        <option value="02">Февраль</option>  
        <option value="03">Март</option>  
        <option value="04">Апрель</option>  
        <option value="05">Май</option>  
        <option value="06">Июнь</option>  
        <option value="07">Июль</option>  
        <option value="08">Август</option>  
        <option value="09">Сентябрь</option>  
        <option value="10">Октябрь</option>  
        <option value="11">Ноябрь</option>  
        <option value="12">Декабрь</option>  
      </select>  
        
         
      <br />  
      <label for="country_code">Выберите страну:</label>      
      <select type="text" name="country_code" id="country_code"></select>      
        
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>      
      <script>      
        $(document).ready(function() {      
          $.getJSON("https://restcountries.com/v3.1/all", function(data) {      
            var countrySelect = $("#country_code");      
            var countries = {};      
            data.forEach(function(item) {      
              var countryCode = item.cca2;   
              var countryName = item.name.common; 
              countries[countryCode] = countryName;  
            });       
            Object.keys(countries).sort().forEach(function(key) {  
              countrySelect.append(`<option value="${key}">${countries[key]} (${key})</option>`);      
            });      
          });     
        });      
      </script>    
    
    
        
      <button type="button" onclick="getData()">Выполнить запрос</button>    
    </section>    
    <script>       
     async function getData() {
  const year = document.getElementById("year").value;
  const country_code = document.getElementById("country_code").value;
  const month = document.getElementById("month").value;

  const holidays = [];
  let j = 0;

  const response = await fetch(`https://date.nager.at/api/v3/PublicHolidays/${year}/${country_code}`);

  if (!response.ok) {
    throw new Error(`Ссылка не найдена. Ошибка ${response.status}`);
  }

  const data = await response.json();

  for (let i = 0; i < data.length; i++) {
    let date = data[i].date.substr(5, 2);

    if (date === month) {
      holidays[j] = [data[i].date, data[i].localName, data[i].name];
      j++;
    }
  }

  const result = document.getElementById("result");
  result.innerHTML = "<h2>Праздники</h2>";

  if (holidays.length === 0) {
    result.innerHTML += "<p>В этом месяце нет праздников для выбранной страны!</p>";
  } else {
    holidays.forEach(function(item) {   
      let date = new Date(item[0]);     
     
      
      let wikiLink = `https://ru.wikipedia.org/wiki/${item[1].replace(/ /g, '_')}`;    
      
      result.innerHTML += `<p><button onclick="openWikiWindow('${wikiLink}')">${date.toLocaleDateString()}</button> - ${item[1]} (${item[2]})</p>`;   
}); 
 
  }
}

function openWikiWindow(link) {
  const wikiWindow = document.getElementById("wikiWindow");
  wikiWindow.innerHTML = `<iframe src="${link}" style="width:100%; height:500px;"></iframe>`;
}
    </script>    
    <div id="result"></div>
    <div id="wikiWindow"></div>
  
  </body>  
</html>

